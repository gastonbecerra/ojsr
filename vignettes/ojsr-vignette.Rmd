---
title: "ojsr-vignette"
author: "Gaston Becerra"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ojsr-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include = FALSE}
library(knitr)
```


# Overview

The aim of this package is to aid you in several OJS tasks, such as: 

- parse OJS urls, according to routing conventions;
- crawling archives, issues, articles, galleys;
- retrieving/scraping meta-data from articles.

**Important: ojsr rely on OJS routing conventions** (see <https://docs.pkp.sfu.ca/dev/documentation/en/architecture-routes>), and therefore are most likely to fail when used on customized OJS installments (i.e., customized themes, routing improvements via .htaccess).



## About OJS

(from the OJS documentation <https://pkp.sfu.ca/ojs/>, as of Jan.2020)

Open Journal Systems (OJS) is a journal management and publishing system that has been developed by the Public Knowledge Project through its federally funded efforts to expand and improve access to research.

OJS assists with every stage of the refereed publishing process, from submissions through to online publication and indexing. Through its management systems, its finely grained indexing of research, and the context it provides for research, OJS seeks to improve both the scholarly and public quality of refereed research.

OJS is open source software made freely available to journals worldwide for the purpose of making open access publishing a viable option for more journals, as open access can increase a journal’s readership as well as its contribution to the public good on a global scale (see PKP Publications).

## OJS v3 and OJS API

Since OJS v3.1+ <https://docs.pkp.sfu.ca/dev/api/ojs/3.1> a Rest API is provided. We're positive a better R interface should use that API instead of scraping web themes and/or OAI records. 

So, why ojsr? According to <https://pkp.sfu.ca/ojs/ojs-usage/ojs-stats/>, as of 2019 (when v3.1+ was launched), OJS was being used by at least 10,000 journals worldwide. OJS is an excellent free publishing solution for institutions that could not publish otherwise. Presumably, most of them do not have the the technical nor financial capabilities to update constantly, so OJS v1+ and v2+ are expected to be around for some time... 



# Installation

```{r message=FALSE, warning=FALSE}
# let's start by loading the libraries
library(ojsr) 
```


# How to use ojsr?

## process_urls: Parse urls to check what type of OJS page they point at

`process_urls()` allows you to parse a list of urls against OJS **routing conventions** (see <https://docs.pkp.sfu.ca/dev/documentation/en/architecture-routes>) to extract the parameters invoked (e.g., article, issues, galley IDs) and generate the *conventional* url for specific purposes (e.g., if you are scrapping article links from an issue, it will provide the issue ToC). **Important:** `process_urls()` parses urls as character strings. The list of urls you input is not actually browsed!

`process_urls()` is invoked from `get_*_url_from_*` functions before and after scraping. On the inputs, it is used to get the *conventional* url required for each scrapping; on the outputs, to ensure the right type of page is pointed at. 

Also, if you are planning to summarize issue/article/galley/metadata information by journal, you may use `process_urls()` to join the scrapped links by the `$base_url` of the journal.


```{r message=FALSE, warning=FALSE}
# urls pointing at different types of OJS pages
url_sample <- c( 
  'https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/article/view/2903',  # article 
  'http://fundacionmenteclara.org.ar/revista/index.php/RCA/issue/view/2018-Vol3-2', # issue with ToC
  'http://fundacionmenteclara.org.ar/revista/index.php/RCA/article/download/43/54', # pdf download
  'https://firstmonday.org/ojs/index.php/fm/article/view/9540', # article view
  'http://imed.pub/ojs/index.php/iam/article/view/1650', # article view
  'http://fundacionmenteclara.org.ar/revista/index.php/RCA/oai', # oai protocol
  'https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/issue/view/444' # issue (no ToC)
)

# we'll parse them, and store the result in a dataframe
parsed_urls <- ojsr::process_urls(url_sample)
```

The resulting dataframe contains the following columns:

1. *input_url* - the url you provided
2. *base_url* - base url of the OJS
3. *issue_id* - if an issue, its ID (string); otherwise NA
4. *article_id* - if an article, its ID (string); otherwise NA
5. *galley_id* - if a galley (full-content, supplementary materials, etc.), its ID (string); otherwise NA
6. *conventional_archive* - the *conventional* form of the url you should use to scrap the list of issues
7. *conventional_issue* - the *conventional* form of the url you should use to scrap the ToC from an issue (if issueID is present, otherwise "")
8. *conventional_article* - the *conventional* form of the url you should use to scrap metadata from an article (if articleID is present, otherwise "")
9. *conventional_oai* - the *conventional* form of the url you should use to access OAI
10. *conventional_search* - the *conventional* form of the url you should use to scrap search results



## get_issues_from_archive: Scraps issues' urls from OJS archive of issues

`get_issues_from_archive()` takes a vector of OJS urls and retrieve the entire list of OJS issues' urls.

For each url provided, `get_issues_from_archive()` will invoke `process_urls()` to retrieve their *archive of issues* (e.g., <https://papiro.unizar.es/ojs/index.php/rc51-jos/issue/archive>). Then, it will look for links containing "/issue/view" in the href. Links are post-processed before returning, to ensure their are poiting to the right type of OJS component.  

```{r}
socPsy_urls <- c( # argentinian social psychology journals
  'https://dspace.palermo.edu/ojs/index.php/psicodebate/issue/archive', # archive of issues
  'https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/article/view/2903' # article
)
issues <- ojsr::get_issues_from_archive(socPsy_urls, verbose = TRUE)
```

Result is in a long-format dataframe (1 input_url may result in several rows, one for each output_url), containing:

1. *input_url* - the url you provided
2. *output_url* - the issues' url scrapped



## get_articles_from_issue: Scrap articles urls from the ToC of OJS issues

`get_articles_from_issue()` takes a vector of OJS urls and scraps them to retrieve the links to articles. 

For each url provided, `get_articles_from_issue()` will invoke `process_urls()` to retrieve the issue's Table of Contents (e.g., <https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/issue/view/319/showToc>). Then, it will look for links containing "/article/view" in the href. Links are post-processed before returning, to ensure their are poiting to the right type of OJS component.

```{r}
socPsy_issues_url <- c( #  initial issues from a few social psychology journals
  'https://revistas.ucn.cl/index.php/saludysociedad/issue/view/65', # includes ToC
  'https://dspace.palermo.edu/ojs/index.php/psicodebate/issue/view/Psicodebate%201', # includes ToC
  'https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/issue/view/31' # no ToC nor links
)
articles <- ojsr::get_articles_from_issue(socPsy_issues_url, verbose = TRUE) 
```

Result is in a long-format dataframe (1 input_url may result in several rows, one for each output_url), containing:

1. *input_url* - the url you provided
2. *output_url* - the articles url scraped



## get_galley_url_from_article: Scrap galleys urls from OJS articles

*Galleys* are the final presentation version of the content of the articles. Most of the time, these include the full-content in pdf and other reading formats. Less often, they are supplementary files (tables, dataset) in different formats. 

`get_galley_url_from_article()` takes a vector of OJS urls and scraps them to retrieve the links to galleys. 

For each url provided, `get_galley_url_from_article()` will invoke `process_urls()` to retrieve the article view url (e.g., <https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/article/view/593>). Then, it will look for links containing "/article/view" in the href. Links are post-processed before returning, to ensure their are poiting to the right type of OJS component.

```{r}
socPsy_articles <- c( # 3 articles on social psychology, specifically social representations theory
  'https://revistapsicologia.uchile.cl/index.php/RDP/article/view/55657', # galleys pdf and mp3
  'https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/article/view/2137', # galley pdf
  'https://dspace.palermo.edu/ojs/index.php/psicodebate/article/view/516/311' # inline reader
)
galleys <- ojsr::get_galley_url_from_article(socPsy_articles,verbose = TRUE) 
```

Result is in a long-format dataframe (1 input_url may result in several rows, one for each output_url), containing:

1. *input_url* - the url you provided
2. *output_url* - the galleys url scraped
3. *format* - the format of the galley (e.g., pdf, xml)
4. *download_url* - the conventional url to force download of the galley. You may pass these to a download function of your own (e.g., <https://stackoverflow.com/questions/39246739/download-multiple-files-using-download-file-function>).



## get_paginated_search_url: Searchs for a criteria in OJS and returns the paginated search result urls

`get_paginated_search_url()` takes a vector of OJS urls and a string for search criteria to compose the search url. 

For each url provided, `get_paginated_search_url()` will invoke `process_urls()` and will use the search criteria provided to retrieve the search results urls. It will also browse the resulting url to check if pagination is involved, and then return the url for the search result pages. You may then pass these urls to any other `get_*_url_from_*()` function. 

```{r}
socPsy_journals <- c( # 2 social psychology journals
  'https://revistapsicologia.uchile.cl/index.php/RDP/', # home url
  'https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/issue/current' # current issue url
)
search_criteria <- "social representations"
search_results <- ojsr::get_paginated_search_url(input_url = socPsy_journals, 
  search_criteria = "psicología social", verbose = TRUE)
```

Result is in a long-format dataframe (1 input_url may result in several rows, one for each output_url), containing:

1. *input_url* - the url you provided
2. *output_url* - the search page result urls



## get_html_meta_from_article: Scrap metadata from html of OJS articles

`get_html_meta_from_article()` takes a vector of OJS urls and scraps the metadata written in the html. 

For each url provided, `get_html_meta_from_article()` will invoke `process_urls()` to retrieve the article view url (e.g., <https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/article/view/593>). Then, it will look for the \<meta\> tags in the \<head\> section of the html. **Important!** This may not only retrieve bibliographic metadata; any other "meta" property detailed on the html will also be captured (e.g., descriptions for propagation on social network, etc.).


```{r}
socPsy_articles <- c( # 3 articles on social psychology, specifically social representations theory
  'https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/article/view/2137', # article
  'https://dspace.palermo.edu/ojs/index.php/psicodebate/article/view/516/311' # xml galley
)
metadata <- ojsr::get_html_meta_from_article(socPsy_articles, verbose = TRUE) 
```

Result is in a long-format dataframe (1 inputUrl may result in several rows, one for each outputUrl), containing:

1. *input_url* - the url you provided
2. *meta_data_name* - name of the property/metadata (e.g., "DC.Date.created" for the Date of creation) 
3. *meta_data_content* - the actual value of the metatag
4. *meta_data_scheme* - the standard in which the content is annotated
5. *meta_data_xmllang* - the language in which the metadata was entered



## get_oai_meta_from_article: Retrieve OAI records for OJS articles

An alternative to webscraping metadata from the html of article pages is to retrieve their OAI-PMH (Open Archives Initiative Protocol for 'Metadata' Harvesting) records <http://www.openarchives.org/OAI/openarchivesprotocol.html>

`get_oai_meta_from_article()` will try to access the OAI records (within the OJS) for any article for which you provided an url. 

**Note:** This function is in a very preliminar stage. If you are interested in working with OAI records, you may want to check Scott Chamberlain's **OAI package for R** <https://CRAN.R-project.org/package=oai>. If you only have the OJS home url, and would like to check all the article's OAI records at one shot, an interesting option is to parse it with `ojsr::process_urls()` and passing the OAI url (`$conventional_oai`) to `oai::list_identifiers()`.

```{r}
socPsy_articles <- c( # 3 articles on social psychology, specifically social representations theory
  'https://publicaciones.sociales.uba.ar/index.php/psicologiasocial/article/view/2137', # article
  'https://dspace.palermo.edu/ojs/index.php/psicodebate/article/view/516/311' # xml galley
)
metadata_oai <- ojsr::get_oai_meta_from_article(input_url = socPsy_articles, verbose = TRUE)
```

Result is in a long-format dataframe (1 inputUrl may result in several rows, one for each outputUrl), containing:

1. *input_url* - the url you provided
2. *meta_data_name* - name of the property/metadata (e.g., "DC.Date.created" for the Date of creation) 
3. *meta_data_content* - the actual value of the metatag
4. *meta_data_scheme* - **always returns NA** (included just for easier binding with `get_meta_from_head()` results)
5. *meta_data_xmllang* - **always returns NA** (included just for easier binding with `get_meta_from_head()` results)
